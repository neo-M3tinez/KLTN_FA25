name: "Malware Detection Response"
description: "Respond to malware detection alerts"
severity: critical
keywords:
  - "malware"
  - "virus"
  - "trojan"
  - "ransomware"
  - "backdoor"
  - "suspicious file"
  - "executable"

workflow:
  - triage_agent
  - malware_agent
  - forensic_agent
  - response_agent

actions:
  - action: "Isolate infected host"
    priority: critical
    automated: true
  
  - action: "Collect malware sample"
    priority: critical
    automated: true
  
  - action: "Analyze file hash with threat intelligence"
    priority: critical
    automated: true
  
  - action: "Check for lateral movement"
    priority: high
    automated: true
  
  - action: "Scan other hosts for same malware"
    priority: high
    automated: true
  
  - action: "Initiate incident response procedure"
    priority: critical
    automated: true

threat_intelligence:
  check_ip: true
  check_domain: true
  check_hash: true
  sources:
    - virustotal
    - abuseipdb
    - hybrid-analysis

siem_queries:
  - name: "File execution events from infected host"
    query: "host.name:{host_name} AND event.category:process"
    timerange: "24h"
  
  - name: "Network connections from infected host"
    query: "host.name:{host_name} AND event.category:network"
    timerange: "24h"
  
  - name: "Similar file hashes in environment"
    query: "file.hash.sha256:{file_hash}"
    timerange: "7d"
  
  - name: "C2 communication indicators"
    query: "destination.ip:{c2_ip} OR destination.domain:{c2_domain}"
    timerange: "7d"

response:
  containment:
    - "Isolate infected systems"
    - "Block malicious IPs/domains at perimeter"
    - "Disable affected user accounts"
  
  eradication:
    - "Remove malware from infected systems"
    - "Clean persistent mechanisms"
    - "Patch vulnerabilities exploited"
  
  recovery:
    - "Restore from clean backups"
    - "Verify system integrity"
    - "Monitor for reinfection"
